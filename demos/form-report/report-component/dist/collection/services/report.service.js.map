{"version":3,"file":"report.service.js","sourceRoot":"","sources":["../../src/services/report.service.ts"],"names":[],"mappings":"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","sourcesContent":["\nimport { PropsService } from './props.service';\nimport { StateService } from './state.service';\nimport { UtilService } from './util.service';\nimport { getItem, getRelatedItems } from \"@esri/arcgis-rest-portal\";\nimport { queryFeatures, getLayer } from '@esri/arcgis-rest-feature-service';\nimport { TranslateService } from './translate.service';\n\n\nexport enum EsriJobStatusType {\n  submitted = 'esriJobSubmitted',\n  executing = 'esriJobExecuting',\n  succeeded = 'esriJobSucceeded',\n  partialSucceeded = 'esriJobPartialSucceeded',\n  failed = 'esriJobFailed',\n  cancelled = 'esriJobStatusCancelled'\n}\n\nexport class ReportService {\n\n  static service: ReportService;\n  public checkingList: any[] = [];  // the job id list which is not complete, should to be checked\n  public isRequestingTasks: boolean = false;\n  public jobList: any = {};\n  private queryJobTimmer: any;\n  private sessionJobs: any[] = [];  // seems this is not needed.\n  private templateItemsCache: any[] = [];\n  private stateService: StateService = StateService.getService();\n\n  // the parameters cache that will be sent to generate report\n  private paramCache: any = {\n\n  };\n\n  // some assosiate data for report, like the feature count\n  private helperObj: {\n    featureCount?: number,\n    surveyIsInvalid?: boolean,\n    canCreateItem?: boolean\n  }\n\n  /**\n   * get Service\n   * @returns \n   */\n  static getService(): ReportService {\n    if (!this.service) {\n      this.service = new ReportService();\n    }\n    return this.service;\n  }\n\n\n  /**\n   * get the report parameter cache\n   * @param key \n   */\n  public getParamCache(key?: string) {\n    if (!key) {\n      return this.paramCache;\n    }\n    return this.paramCache ? this.paramCache[key] : null;\n  }\n\n  /**\n   * set the report parameter cache\n   * @param obj \n   */\n  public setParamCache(obj: any) {\n    if (!obj) {\n      return;\n    }\n    this.paramCache = Object.assign(this.paramCache || {}, obj);\n  }\n\n  public initParamCache() {\n\n  }\n\n\n  /**\n   * get the report parameter cache\n   * @param key \n   */\n  public getHelperObj(key?: string) {\n    if (!key) {\n      return this.helperObj;\n    }\n    if (!this.helperObj) {\n      return null;\n    }\n    return this.helperObj[key];\n  }\n\n  /**\n   * set the report parameter cache\n   * @param obj \n   */\n  public setHelperObj(obj: any) {\n    if (!obj) {\n      return;\n    }\n    this.helperObj = Object.assign(this.helperObj || {}, obj);\n  }\n\n  /**\n   * getReportTemplates\n   * @param surveyItemId \n   */\n  public getReportTemplates(surveyItemId: string, options?: {\n    templateIds?: string;\n  }) {\n    options = options || {};\n    let hasTemplateIds = false;\n    if ('templateIds' in options && options.templateIds !== undefined) {\n      hasTemplateIds = true;\n    }\n    const templateIds = options?.templateIds || '';\n    const cache = this.templateItemsCache || [];\n    // TBD：\n    // if (!surveyItemId) {\n    //   return Promise.resolve([]);\n    // }  \n    \n    const utilService: UtilService = UtilService.getService();    \n    // check if the portal support survey2data relation\n    return Promise.resolve(true)\n    .then(() => {\n      const support = utilService.supportFeatureReport();\n      if (!support) {\n        throw new Error('This portal does not support custom report.');\n      }\n      return true;\n    })\n    .then(() => {\n      if (hasTemplateIds) {\n        // get all the template id item info\n        const requests = [];\n        templateIds.split(',').forEach((id) => {\n          const existingItem = cache.find((item) => {\n            return item.id === id;\n          });\n          let req = null;\n          if (existingItem) {\n            req = Promise.resolve(existingItem);\n          } else {\n            req = getItem(id, utilService.getBaseRequestOptions()).then((itemJson) => {\n              return itemJson\n            }).catch(() => {\n              console.log('Cannot get item info for the report template with id' + id);\n              return {};\n            });\n          }\n          requests.push(req);\n        });\n        return Promise.all(requests).then((resp) => {\n          return {\n            relatedItems: resp\n          };\n        })\n      } else if(surveyItemId && !this.getHelperObj('surveyIsInvalid')) {\n        const params: any = Object.assign({id: surveyItemId, relationshipType: 'Survey2Data'}, utilService.getBaseRequestOptions());\n        return getRelatedItems(params);\n      } else {\n        return {\n          relatedItems: []\n        }\n      }\n\n    })\n    .then((res: any) => {\n      if (!res || res.error) {\n        throw new Error('Failed to get related templates');\n      }\n\n      this.templateItemsCache = res.relatedItems || [];\n      const config = {\n        typeKeyword: 'Print Template',\n        type: 'Microsoft Word'\n      };\n      const results = res.relatedItems.filter((item) => {\n        // only type and typekeywords is match\n        return item.type === config.type && item.typeKeywords.indexOf(config.typeKeyword) !== -1;\n      });\n      return results || [];\n    })\n    .then((items) => {\n      const printTemplates = [];\n\n      items.forEach((item) => {\n        const templateUrl = this.getCustomPrintingFileUrl(item.id);\n        const template = {\n          id: item.id,\n          name: item.name,\n          title: item.title,\n          summary: item.snippet,\n          modified: new Date(item.modified),\n          url: templateUrl,\n          typeKeywords: item.typeKeywords,\n          type: item.type\n          // isInnerWorking: false\n        };\n        printTemplates.push(template);\n      });\n      \n      if (hasTemplateIds) {\n        printTemplates.sort((a, b) => {\n          if (a.modified < b.modified) {\n            return 1;\n          } else {\n            return -1;\n          }\n        });\n      }\n\n\n      return printTemplates;\n    });\n  }\n\n  /**\n   * get layer json\n   * @param layerUrl \n   */\n  public getLayerJson(layerUrl?: string) {\n    layerUrl = layerUrl || PropsService.featureLayerUrl\n    // read from cache\n    const cacheLayerJsons = this.getHelperObj('layerJsons') || []\n    const cacheLayer = cacheLayerJsons.find((layerObj) => {\n      return layerObj.url === layerUrl && layerObj.json;\n    })\n    if (cacheLayer) {\n      return Promise.resolve(cacheLayer.json);\n    }\n    return getLayer({\n      url: PropsService.featureLayerUrl,\n      authentication: PropsService.token\n    }).then((layerJson) => {\n      cacheLayerJsons.push({\n        url: layerUrl,\n        json: layerJson\n      });\n      this.setHelperObj({layerJsons: cacheLayerJsons});\n      return layerJson;\n    })\n  }\n\n  /**\n   * get feature count\n   * @returns \n   */\n  public getFeatureCount() {\n    const queryParms = JSON.parse(PropsService.queryParameters);\n    delete queryParms.orderByFields; // because the feature report's orderByFields is not the same with the rest api's\n    /**\n     * query features\n     */\n    const params = Object.assign({\n      url: PropsService.featureLayerUrl,\n      authentication: PropsService.token,    \n      returnCountOnly: true\n      }, queryParms);\n\n    const where = 'where' in params ? params.where : null\n    const objectIds = 'objectIds' in params ? params.objectIds: null\n    const additionalParams: any  = {\n\n    };\n    if (where !== null) {\n      additionalParams.where = where;\n    }\n    if (objectIds != null) {\n      additionalParams.objectIds = objectIds;\n    }\n    if (!objectIds && !where) {\n      additionalParams.where = '1<>1'; // if no objectIds and where, set where as '1<>1' to avoid requesting error\n      delete additionalParams.objectIds\n    }\n\n    params.params = additionalParams;\n    delete params.where;\n    delete params.objectIds;\n\n    return queryFeatures(params)\n    .then((result: any) => {\n      let count = result.count;\n      if (queryParms.resultRecordCount < count) {\n        count = queryParms.resultRecordCount\n      }\n      this.setHelperObj({\n        featureCount: count\n      });\n      this.stateService.notifyDataChanged('feature-count-updated');\n      return;\n    }).catch((e) => {\n      this.manageError(e, 'featureLayerUrl');\n  });\n}\n\n  /**\n   * get custom printing file url (e.g. word)\n   * @param itemId: String\n   * @return string\n   */\n  public getCustomPrintingFileUrl(itemId: string): string {\n    return `${PropsService.portalUrl}/sharing/rest/content/items/${itemId}/data?token=${PropsService.token}`;\n  }\n\n  /**\n   * estimate report costs  \n   * @param options\n   */\n  public estimateReportCosts(options: any) {\n    const defautlParams = {\n      portalUrl: PropsService.portalUrl,\n      token: PropsService.token,\n      f: 'json'\n    };\n    const params = Object.assign(defautlParams, options || {});\n    // if (this.isInternalTest()) {\n    //   params['isInternalTest'] = true;\n    // }\n\n    const body = new URLSearchParams();\n    Object.keys(params).forEach((k) => {\n      const value = params[k];\n      body.append(k, value);\n    });\n    const url = `${PropsService.apiUrl}/estimateCredits`;\n    return fetch(url, {\n      method: 'POST',\n      headers: this._generateRequestHeaders(),\n      body\n    })\n    .then((res) => {\n      return res.json();\n    });\n  }\n\n  /**\n   * print report\n   */\n  public executeReport(options: any) {\n    const locale = PropsService.locale || 'en';\n    const defautlParams = {\n      // outputFormat: 'docx',\n      portalUrl: PropsService.portalUrl,\n      utcOffset: '||' + this._getLocalTimezoneOffset(),\n      locale: '||' + locale,\n      token: PropsService.token,\n      f: 'json'\n    };\n    const params = Object.assign(defautlParams, options || {});\n    if ((!params.uploadInfo || params.uploadInfo === 'null') && Object.prototype.hasOwnProperty.call(params, 'uploadInfo')) {\n      delete params.uploadInfo;\n    }\n    // if (this.isInternalTest()) {\n    //   params['isInternalTest'] = true;\n    // }\n\n    const body = new URLSearchParams();\n    Object.keys(params).forEach((k) => {\n      const value = params[k];\n      body.append(k, value);\n    });\n\n    const url = `${PropsService.apiUrl}/createReport/submitJob`;\n    return fetch(url, {\n      method: 'POST',\n      headers: this._generateRequestHeaders(),\n      body\n    })\n    .then((res) => {\n      return res.json();\n    });\n  }\n\n    /**\n   * createSampleReport\n   * @param options\n   */\n    public createSampleReport(options: any) {\n      const locale = PropsService.locale || 'en';\n\n      const defautlParams = {\n        // outputFormat: 'docx',\n        portalUrl: PropsService.portalUrl,\n        utcOffset: '||' + this._getLocalTimezoneOffset(),\n        locale: '||' + locale,\n        token: PropsService.token,\n        f: 'json'\n      };\n      \n      const params = Object.assign(defautlParams, options || {});\n      const body = new URLSearchParams();\n      Object.keys(params).forEach((k) => {\n        const value = params[k];\n        body.append(k, value);\n      });\n      // if (this.isInternalTest()) {\n      //   params['isInternalTest'] = true;\n      // }\n\n      const url = `${PropsService.apiUrl}/createSampleReport/submitJob`;\n      return fetch(url, {\n        method: 'POST',\n        headers: this._generateRequestHeaders(),\n        body\n      })\n      .then((res) => {\n        return res.json();\n      });\n    }\n\n    /**\n   * remove job\n   * @param jobId \n   * @returns \n   */\n    public removeJob(jobId) {\n      const params = {\n        portalUrl: PropsService.portalUrl,\n        token: PropsService.token,\n        f: 'json'\n      };\n      // if (this.isInternalTest()) {\n      //   params['isInternalTest'] = true;\n      // }\n  \n      const body = new URLSearchParams();\n      Object.keys(params).forEach((k) => {\n        const value = params[k];\n        body.append(k, value);\n      });\n  \n      const url = `${PropsService.apiUrl}/jobs/${jobId}/remove`;\n      return fetch(url, {\n        method: 'POST',\n        headers: this._generateRequestHeaders(),\n        body\n      })\n      .then((res) => {\n        return res.json();\n      });\n\n    }\n    \n    public cancelJob(jobId) {\n      const params = {\n        portalUrl: PropsService.portalUrl,\n        token: PropsService.token,\n        f: 'json'\n      };\n      // if (this.isInternalTest()) {\n      //   params['isInternalTest'] = true;\n      // }\n  \n      const body = new URLSearchParams();\n      Object.keys(params).forEach((k) => {\n        const value = params[k];\n        body.append(k, value);\n      });\n  \n      const url = `${PropsService.apiUrl}/jobs/${jobId}/cancel`;\n      return fetch(url, {\n        method: 'POST',\n        headers: this._generateRequestHeaders(),\n        body\n      })\n      .then((res) => {\n        return res.json();\n      });\n\n    }\n\n    /**\n     * Deprecated, remove job from the job list\n     * @param job \n     * @returns \n     */\n    public removeJobFromList(job) {\n      if (!job) {\n        return;\n      }\n      // const jobId = job.jobId;\n      // // if the job is the session job, stop the check status process\n      // const isSessionJob = this.sessionJobs.indexOf(job.jobId) >= 0;\n      // if (isSessionJob) {\n      //   // delete from the sessionJobs\n      //   this.sessionJobs.splice(this.sessionJobs.indexOf(jobId), 1);\n      //   // delete the timmer\n      //   if (this.queryJobStatusTimmerList[jobId]) {\n      //     delete this.queryJobStatusTimmerList[jobId];\n      //   }\n      // }\n  \n      // remove the job from the checking\n      // this.checkingList.splice(this.checkingList.indexOf(jobId), 1);\n      // setTimeout(() => { this.checkingListChange = false; }, 1500);\n  \n      // remove the job from the jobs list\n      if (this.jobList && this.jobList.jobs) {\n        const targetIdx = this.jobList.jobs.findIndex((jobItem) => {\n          return jobItem.jobId === job.jobId;\n        })\n        this.jobList.jobs.splice(targetIdx, 1);\n        this.jobList.jobs = [].concat(this.jobList.jobs);\n      }\n  \n      // todo: query job list again (load the 11th job)  \n      // this.queryJobs(true);\n    }\n\n\n  /**\n   * query jobs\n   * @param forceQuery \n   * @returns \n   */\n  public queryJobs(forceQuery?: boolean) {\n    if (this.checkingList.length < 1 && !forceQuery) {\n      return Promise.resolve(null);\n    }\n    // if (!this.surveyId) {\n    //   setTimeout(() => { this.queryJobs(forceQuery); }, 1000);\n    //   return Promise.resolve(null);\n    // }\n    // if (this.state !== 'query' && !forceQuery) {\n    //   if (this.queryJobTimmer) {\n    //     clearTimeout(this.queryJobTimmer);\n    //   }\n    //   this.queryJobTimmer = setTimeout(() => { this.queryJobs() }, 10000);\n    //   return Promise.resolve(null);\n    // }\n    if (this.isRequestingTasks) {\n      return Promise.resolve(null);\n    }\n    this.isRequestingTasks = true;\n    return this.sendQueryJobsRequest(PropsService.surveyItemId)\n      .then((res) => {\n        if (res.error) {\n          throw res.error;\n        }\n  \n        return res;\n      })\n      .then((res) => {\n        this.isRequestingTasks = false;\n      // this.jobList = res; // todo: only add the new job\n\n      if (!this.jobList.jobs) {\n        this.jobList.jobs = [];\n      }\n      if (res && res.jobs && res.jobs.length) {\n        // add the new job to the job list\n        res.jobs.forEach((jobObj, idx) => {\n          const curId = jobObj.jobId;\n          // let isOldJob = this.jobList.jobs.find((item) => {\n          //   return item.jobId === curId;\n          // });\n          // if (!isOldJob) {\n          //   newJobs.push(jobObj);\n          // }\n          // set the old job to the new job to avoid sending the checkJobStatus request,because the new job contains the detail info which is getted from checkjobstatus\n          const oldJob = this.jobList.jobs.filter((item) => {\n            return item.jobId === curId;\n          });\n          if (oldJob && oldJob.length) {\n            res.jobs[idx] = oldJob[0];\n          }\n          // if the job contains runtime data(related to cancel job/ remove job status), keept it\n          if (oldJob && oldJob._tempRuntime) {\n            res.jobs[idx]._tempRuntime = Object.assign(oldJob._tempRuntime, res.jobs[idx]._tempRuntime || {});\n          }\n        });\n        this.jobList.jobs = res.jobs; // newJobs.concat(this.jobList.jobs);\n\n      } else if (res && res.error) {\n        const errorMsg = 'Oops! An error occurred loading the job list';\n        console.log(res.error && res.error.message ? res.error.message : errorMsg);\n        return false;\n      }\n\n      // this.checkJobListDetails();\n      if (this.queryJobTimmer) {\n        clearTimeout(this.queryJobTimmer);\n      }\n      this.queryJobTimmer = setTimeout(() => { this.queryJobs() }, 10000);\n      return this.jobList;\n    }).catch(() => {\n      this.isRequestingTasks = false;\n      console.log('query jobs failed.');\n      if (this.queryJobTimmer) {\n        clearTimeout(this.queryJobTimmer);\n      }\n      this.queryJobTimmer = setTimeout(() => { this.queryJobs() }, 10000);\n      throw new Error();\n    });\n  }\n\n  /**\n   * check all the jobs, if any job is failed, and it has no details, call the status api to get the details\n   */\n  public checkJobListDetails() {\n    const jobs = this.jobList.jobs;\n    if (!jobs || !jobs.length) {\n      return;\n    }\n    jobs.forEach((job, idx) => {\n      // request job status for succeed jobs to show the download buttons\n      if ((job.jobStatus === 'esriJobSucceeded' || job.jobStatus === 'esriJobPartialSucceeded') && (!job.resultInfo || !job.resultInfo.resultFiles)) {\n        // if the job is succeded, get the download url , and check if it contains error records\n        this.checkJobStatus(job.jobId).then((res) => {\n          this.jobList.jobs[idx] = {...this.updateJobDetail(res)};\n          this.stateService.notifyDataChanged('job-updated', {value: this.jobList.jobs[idx]});\n          this.stateService.notifyDataChanged('job-complete', {value: this.jobList.jobs[idx]});\n\n        });\n      } else if (job.jobStatus === EsriJobStatusType.executing || job.jobStatus === EsriJobStatusType.submitted) {\n        /**\n         * if the job is executing, check job status until it succeeded or failed, only one exception:\n         * if ther job is the session job, do not checkJobStatus again, \n         * because after executeCustomReport request, we has called checkJobStatus request mannually\n         */\n          const isSessionJob = this.sessionJobs.indexOf(job.jobId) >= 0;\n          if (!isSessionJob) {\n            this.checkJobStatus(job.jobId);\n            \n          }\n      } else {\n        this.jobList.jobs[idx] = {...this.updateJobDetail(this.jobList.jobs[idx])};\n        this.stateService.notifyDataChanged('job-updated', {value: this.jobList.jobs[idx]});\n        if (job.jobStatus === EsriJobStatusType.failed) {\n          this.stateService.notifyDataChanged('job-complete', {value: job});\n          \n        }\n\n      }\n      // if (!job.inputInfo) {\n      //   // if (!job.inputs && (job.jobStatus === 'esriJobFailed')) {\n\n      //   // if the job is failed, and has no detail,get the details\n      //   if (job.jobStatus === 'esriJobFailed') {\n      //     this.survey123ApiService.checkJobStatus(job.jobId).then((res) => {\n      //       let showDetail = job.showDetail;\n      //       job = res;\n      //       job.showDetail = showDetail;\n      //       this.jobList.jobs[idx] = job;\n      //     });\n      //   } else if (job.jobStatus === 'esriJobSucceeded') {\n      //     // if the job is succeded, get the download url , and check if it contains error records\n      //     this.survey123ApiService.checkJobStatus(job.jobId).then((res) => {\n      //       this.jobList.jobs[idx] = this.updateJobDetail(res);\n      //     });\n      //   }\n\n      // }\n    });\n  }\n  /**\n   * check job detail, if the job is failed, and it has no details, call the status api to get the details\n   */\n  public checkJobDetails(job: any) {\n    if (!job || job.hasDetail) {\n      return Promise.resolve(job);\n    }\n    if ([EsriJobStatusType.succeeded, EsriJobStatusType.partialSucceeded, EsriJobStatusType.failed,  EsriJobStatusType.cancelled].indexOf(job.jobStatus) >=0) {\n      this.stateService.notifyDataChanged('job-complete', {value: job});\n    }\n\n    // request job status for succeed jobs to show the download buttons\n    if ((job.jobStatus === EsriJobStatusType.succeeded || job.jobStatus === EsriJobStatusType.partialSucceeded) && (!job.resultInfo || !job.resultInfo.resultFiles)) {\n      // if the job is succeded, get the download url , and check if it contains error records\n      return this.checkJobStatus(job.jobId).then((res) => {\n        job = this.updateJobDetail(res);\n        this.stateService.notifyDataChanged('job-updated', {value: job});\n        this.stateService.notifyDataChanged('job-complete', {value: job});\n        // job = {...this.updateJobDetail(res)};\n        return job;\n      });\n    } else if (job.jobStatus ===EsriJobStatusType.failed && (!job.resultInfo || !job.resultInfo.details)) {\n      // failed task\n      return this.checkJobStatus(job.jobId).then((res) => {\n        job = this.updateJobDetail(res);\n        this.stateService.notifyDataChanged('job-updated', {value: job});\n        // job = {...this.updateJobDetail(res)};\n        return job;\n      });\n    } else if (job.jobStatus === EsriJobStatusType.executing || job.jobStatus === EsriJobStatusType.submitted) {\n      \n      this.stateService.notifyDataChanged('job-updated', {value: job});\n      /**\n       * if the job is executing, check job status until it succeeded or failed, only one exception:\n       * if ther job is the session job, do not checkJobStatus again, \n       * because after executeCustomReport request, we has called checkJobStatus request mannually\n       */\n        const isSessionJob = this.sessionJobs.indexOf(job.jobId) >= 0;\n        if (!isSessionJob) {\n          this.checkJobStatus(job.jobId).then((resp) => {\n            return this.checkJobDetails(resp);\n          });\n        }\n        return Promise.resolve(job);\n    } else {\n      // job = this.updateJobDetail(job);\n      job = {...this.updateJobDetail(job)};\n      this.stateService.notifyDataChanged('job-updated', {value:job});\n\n    }\n    return Promise.resolve(job);\n  }\n\n  /**\n   * query job list\n   */\n  public sendQueryJobsRequest(surveyItemId?) {\n    const params: any = {\n      // surveyItemId: surveyItemId,\n      portalUrl: PropsService.portalUrl,\n      f: 'json',\n      token: PropsService.token\n    };\n    if (surveyItemId) {\n      params.surveyItemId = surveyItemId;\n    }\n    const body = new URLSearchParams();\n    Object.keys(params).forEach((k) => {\n      const value = params[k];\n      body.append(k, value);\n    });\n    // if (this.isInternalTest()) {\n    //   params['isInternalTest'] = true;\n    // }\n    const url = PropsService.apiUrl + '/queryJobs';\n    return fetch(url, {\n      method: 'POST',\n      headers: this._generateRequestHeaders(),\n      body\n    })\n    .then((res) => {\n      return res.json();\n    });\n  }\n\n  /**\n   * checkJobStatus\n   */\n  public checkJobStatus(jobId: string) {\n    const params = {\n      f: 'json',\n      portalUrl: PropsService.portalUrl,\n      token: PropsService.token\n    };\n    const body = new URLSearchParams();\n    Object.keys(params).forEach((k) => {\n      const value = params[k];\n      body.append(k, value);\n    });\n    // if (this.isInternalTest()) {\n    //   params['isInternalTest'] = true;\n    // }\n    const url = `${PropsService.apiUrl}/jobs/${jobId}/status`;\n    return fetch(url, {\n      method: 'POST',\n      headers: this._generateRequestHeaders(),\n      body\n    })\n    .then((res) => {\n      return res.json();\n    });\n\n  }\n\n  public downloadReport(job) {\n    let format = 'docx';\n    if (job.inputInfo && job.inputInfo.parameters) {\n      format = job.inputInfo.parameters.outputFormat || 'docx';\n    }\n    this.downloadFile(job, format === 'pdf');\n    // delete from the sessionJobs\n    // this.sessionJobs.splice(this.sessionJobs.indexOf(jobId), 1);\n    // delete the timmer\n    // if (this.queryJobStatusTimmerList[jobId]) {\n    //   delete this.queryJobStatusTimmerList[jobId];\n    // }\n    if (job.jobStatus === 'esriJobPartialSucceeded') {\n      // this.alertService.setOption({\n      //   alertType: 'warning',\n      //   html: this.langSurveyData.customPrint.printWarningMsg\n      // }).show();\n    }\n  }\n\n  /**\n   * download file\n   * @param jobObj \n   * @param openInNewtab \n   * @returns \n   */\n  public downloadFile(jobObj, openInNewtab?) {\n    if (!jobObj || !jobObj.resultInfo || !jobObj.resultInfo.resultFiles) {\n      return;\n    }\n    const resultFiles = jobObj.resultInfo.resultFiles;\n\n    resultFiles.forEach((item, idx) => {\n      let downloadUrl = item.url;\n      if (!downloadUrl) {\n        const itemId = item.id || '';\n        downloadUrl = `${PropsService.portalUrl}/sharing/rest/content/items/${itemId}/data?`;\n        downloadUrl = downloadUrl + 'token=' + PropsService.token;\n      }\n\n      if (idx > 0) {\n        setTimeout(() => {\n          this.startDownload(downloadUrl, openInNewtab);\n        }, 3000);\n      } else {\n        this.startDownload(downloadUrl, openInNewtab);\n      }\n    });\n  }\n\n  public startDownload(url: string, openInNewtab?) {\n    const a = document.createElement('a');\n    a.style.display = 'block';\n    document.body.appendChild(a);\n    a.setAttribute('href', url);\n    if (openInNewtab) {\n      a.setAttribute('target', '_blank');\n    }\n    a.click();\n    a.remove();\n  }\n\n  public getErrorStr(err) {\n    let detail = '';\n    if (err) {\n      if (typeof err === 'string') {\n        detail = err;\n      } else if (err.error && typeof err.error === 'string') {\n        detail = err.error;\n      } else if (err.error && err.error.message) {\n        detail = err.error;\n      } else if (!detail && err.status && err.statusText) {\n        detail = err.status + ' ' + err.statusText;\n      } else if (!detail && err.status && !err.statusText) {\n        detail = 'Error code: ' + err.status;\n      }\n    }\n    return detail;\n  }\n\n\n  /**\n  * show error\n  * @param errorStr \n  */\n  public showError(err, options?: {alertType?: string; errorStr?: string; detail?: any; showDetails?: boolean}) {\n    let html = '';\n    options = options || {};\n    let detail = options.detail || '';\n    if (options.errorStr) {\n      html = options.errorStr;\n    } else {\n      /**\n       * 40x or 50x error(like 404 or 500 error)\n       * the strcuture likes: \n       * {\n       *   error: {\n       *    message: ‘Failed to fetch’,\n       *    stack: ‘’\n       *  }\n       * }\n       */\n      if (err.error && err.error.message) {\n        html = err.error.message;\n      }\n    }\n \n    if (!options.detail && options.showDetails) {\n      // if (err.error && err.error instanceof ArcGISRequestError &&  err.error.message) {\n      if (err.error.response && err.error.response.error && err.error.response.error.detail) {\n        detail = err.error.response.error.detail;\n      }\n      // }\n      if (!detail && options.errorStr && err.error && err.error.message) {\n        detail = err.error.message;\n      }\n \n    }\n    if (!html && err.message) {\n      html = err.message;\n    }\n    this.stateService.notifyDataChanged('show-error', {\n      value: {\n        alertType: options.alertType || 'danger',\n        html: html,\n        detail: detail\n      }\n    });\n  }\n\n  /**\n   * manage the error from server side\n   * @param e \n   * @param type \n   */\n  public manageError(e: any, type: string) {\n    // code: 400, item not exist\n    // code 403, has no priviliage to access the item\n      if (e.response?.error?.code === 400 || e.code === 'CONT_0001'\n        || e.response?.error?.code === 403 || e.code === 'GWM_0003'\n    ) {\n      const i18n = TranslateService.getService().getTranslateSync() || {};\n      const errMsg = i18n.customPrint?.noItemErr;\n      if (errMsg && type) {\n        throw Error(errMsg.replace('${$notFoundItemID}', type + '=' + PropsService[type]));\n      }\n    }\n    throw e;\n  }\n\n\n  /**\n   * update job detail\n   * @param res \n   * @returns \n   */\n  private updateJobDetail(res) {\n    const utilService: UtilService = UtilService.getService();\n    const job = res;\n    // if (job.jobStatus === 'esriJobSucceeded' && job.resultInfo.failedObjectIds && job.resultInfo.failedObjectIds.length > 0) {\n    //   job.hasWarnning = true;\n    // }\n    if (job && this.jobList.jobs && this.jobList.jobs.length) {\n      const oldJob = this.jobList.jobs.find((oldJ) => {\n        return oldJ.jobId === job.jobId;\n      });\n      // if the job contains runtime data(related to cancel job/ remove job status), keept it\n      if (oldJob && oldJob._tempRuntime) {\n        job._tempRuntime = Object.assign(oldJob._tempRuntime, job._tempRuntime || {});\n      }\n    }\n\n    if (!res || !res.resultInfo) {\n      return job;\n    }\n    // for succeceded job\n    if (res.resultInfo.resultFiles && res.resultInfo.resultFiles.length) {\n      let url = '';\n      const resultFiles = res.resultInfo.resultFiles;\n      // todo:check the result file source: res.inputInfo.parameters.uploadInfo? online: s3\n      let isS3File = true;\n      if (res.inputInfo && res.inputInfo.parameters && res.inputInfo.parameters.uploadInfo && res.inputInfo.parameters.uploadInfo.type === 'arcgis') {\n        isS3File = false;\n      }\n      job.multipleFiles = resultFiles.length > 1 ? true : false;\n\n      if (isS3File) {\n        if (!isNaN(Number(job.completed))) {\n          if (!job.multipleFiles) {\n            url = resultFiles[0].url;\n          }\n          if (resultFiles[0].status === 'expired') {\n            job.urlExpired = true;\n          }\n          // const seconds = this.getReportMergeConfig('s3FileRetentionTime');\n          // if (new Date().getTime() - job.completed > seconds) {\n          //   job.urlExpired = true;\n          // }\n        }\n      } else {\n        // get the url from online item\n        resultFiles.forEach((item, idx) => {\n          const itemId = item.id || '';\n          let fileUrl = `${PropsService.portalUrl}/sharing/rest/content/items/${itemId}/data?`;\n          fileUrl = fileUrl + 'token=' + PropsService.token;\n          resultFiles[idx].url = fileUrl;\n          resultFiles[idx].size = utilService.getFileSize(item.size);\n        });\n        if (!job.multipleFiles) {\n          url = resultFiles[0].url;\n        }\n      }\n      if (!job.multipleFiles) {\n        job.url = url;\n      }\n    }\n    // for failed jobs(or succeed with faild objectids), merge the same failed objectids\n    if (job.resultInfo.details) {\n      const details = job.resultInfo.details || [];\n      const findMatchedInfo = (source, target) => {\n        const status = source.status;\n        const messages = source.messages;\n        const success = source.success;\n        const objectId = source.objectId;\n        // tslint:disable-next-line:forin\n        for (const i in target) {\n          const item = target[i];\n          if (status === item.status && success === item.success && JSON.stringify(messages || []) === JSON.stringify(item.messages || []) && item.objectIds.indexOf(objectId) < 0) {\n            return item;\n          }\n        }\n        return null;\n      };\n      if (details && details.length) {\n        const failedInfo = [];\n        details.forEach((detail) => {\n          const mathchedInfo = findMatchedInfo(detail, failedInfo);\n          if (!mathchedInfo) {\n            const newFailedOIDs = (detail.objectId + '').split(',').join(', ');\n            failedInfo.push({\n              status: detail.status,\n              messages: detail.messages,\n              success: detail.success,\n              objectIds: [newFailedOIDs]\n            });\n          } else {\n            mathchedInfo.objectIds.push(detail.objectId);\n          }\n        });\n        failedInfo.forEach((info) => {\n          info.objectIds = info.objectIds.join(', ');\n\n        })\n        job.failedInfo = failedInfo;\n      }\n    }\n    job.hasDetail = true;\n    return job;\n  }\n\n  /**\n   * _getLocalTimezoneOffset\n   */\n  private _getLocalTimezoneOffset() {\n    if (PropsService.utcOffset) {\n      return PropsService.utcOffset;\n    }\n    const timezoneOffsetMin = (new Date()).getTimezoneOffset();\n    let offsetHrs: any = Math.abs(timezoneOffsetMin / 60);\n    let offsetMin: any = Math.abs(timezoneOffsetMin % 60);\n\n    if (offsetHrs < 10) {\n      offsetHrs = '0' + offsetHrs;\n    }\n\n    if (offsetMin < 10) {\n      offsetMin = '0' + offsetMin;\n    }\n\n    // Add an opposite sign to the offset\n    const direction = (timezoneOffsetMin <= 0) ? '+' : '-';\n    const timezoneOffset = direction + offsetHrs + ':' + offsetMin;\n\n    // \"±hh:mm\"\n    return timezoneOffset;\n  }\n\n  /**\n   * generate request headers\n   * @returns \n   */\n  private _generateRequestHeaders() {\n    const headers: any = {\n      'contentType': 'application/x-www-form-urlencoded'\n    };\n    if (PropsService.requestSource === undefined) {\n      headers['X-Esri-Request-Source'] = 'MapsSDKJS/WebComponent';\n\n    } else if (!PropsService.requestSource  || (PropsService.requestSource + '').toLowerCase() === 'none') {\n      // do not set the X-Esri-Request-Source header\n    } else {\n      headers['X-Esri-Request-Source'] = PropsService.requestSource;\n    }\n    return headers\n  }\n\n\n}\n"]}