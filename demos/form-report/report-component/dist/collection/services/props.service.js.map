{"version":3,"file":"props.service.js","sourceRoot":"","sources":["../../src/services/props.service.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * This class aims to store the shared props\n */\nexport class PropsService {\n  \n  /**\n   * report parameters\n   * all the paraemters are listed in: https://devtopia.esri.com/Beijing-R-D-Center/feature-report/issues/505#issuecomment-4495107\n   */\n\n  // token, required\n  static token: string;\n\n  static portalUrl?: string;\n\n  static apiUrl?: string;\n\n  // Feature layer or table URL. required\n  static featureLayerUrl: string;\n\n  static surveyItemId?: string;\n\n  static templateItemId?: string;\n\n  static queryParameters: string;  // Object string\n  \n  static mergeFiles: 'none' | 'nextPage' | 'continuous';\n\n  static outputFormat: string;\n  \n  static outputReportName: string;\n  \n  static outputPackageName: string;\n  \n  static packageFiles: boolean | string;\n  \n  static uploadInfo: string;   // Object string\n  \n  static webmapItemId: string;\n  \n  static mapScale: string;\n\n  static locale?: string;\n\n  static utcOffset?: string;\n\n  static reportTemplateIds?: string;\n\n  static clientId?: string;\n\n  static requestSource: string;\n\n\n  /**\n   * the following parameters are geneareted by the main parameters, ie:\n   * the where is genereated from queryParameters\n   * the username is generated from token \n   */\n  static where: string;\n\n  static username?: string;\n\n  /**\n   * ui parameters\n   */\n  static show: string;\n\n  static hide: string;\n\n  static inputFeatureTemplate: string;\n\n  static label: string;\n\n  // /**\n  //  * @internal\n  //  * @param metadata \n  //  */\n  // constructor(metadata?: any) {\n  //   const defaultValue = {\n  //     url: 'https://survey123.arcgis.com/api/featureReport',\n  //     itemId: null,\n  //     token: null,\n  //     portalUrl: 'https://www.arcgis.com',\n  //     f: 'json'\n  //   };\n\n  //   Object.assign(this, defaultValue, metadata || {});\n  // }\n\n  static paramesWhitelist: string[] = ['token', 'portalUrl', 'apiUrl', 'featureLayerUrl', 'surveyItemId', \n  'templateItemId', 'queryParameters', 'mergeFiles', 'outputFormat', 'outputReportName', \n  'outputPackageName', 'packageFiles', 'uploadInfo', 'webmapItemId', 'mapScale', \n  'locale', 'utcOffset', 'where', 'username', 'show', 'hide', 'inputFeatureTemplate', 'label', 'reportTemplateIds', 'clientId', 'requestSource'];\n  /**\n   * set props\n   * @param obj \n   */\n  static setProps(obj) {\n    const whitelist = PropsService.paramesWhitelist;\n\n    let env = '';\n    const pattern = /survey123(.*?).arcgis.com/;\n    const match = window.location.hostname.match(pattern);\n    if (match && match[1]) {\n      if (['dev', 'qa', 'beta'].includes(match[1])) {\n        env = match[1];\n      }\n    }\n\n    const defaultLocale = this.getLocale();\n    const defaultValue = {\n      apiUrl: `https://survey123${env}.arcgis.com/api/featureReport`,\n      itemId: null,\n      token: null,\n      outputFormat: 'docx',\n      portalUrl: 'https://www.arcgis.com',\n      locale: defaultLocale,\n      f: 'json'\n    };\n\n    if (typeof obj === 'object') {\n      for (let key in obj) {\n        if (whitelist.indexOf(key) >= 0) {\n          PropsService[key] = obj[key] || defaultValue[key] || obj[key];\n          if (key === 'locale' && obj[key]) {\n            PropsService[key] = this.convertToSupportedLang(obj[key]);\n          }\n        }\n      }\n      // Object.assign(this, obj || {});\n    }\n\n    if (PropsService.outputFormat !== 'docx' && PropsService.outputFormat !== 'pdf') {\n      PropsService.outputFormat = 'docx';\n    }\n  }\n\n  /**\n   * get locale\n   * @returns \n   */\n  static getLocale(options?: {\n    userDefinedLocale?: string;\n    userInfo?: any;\n    portalInfo?: any;\n  }) {\n    options = Object.assign({\n\n    }, options || {});\n\n    let userInfo = options.userInfo || {};\n    let portalInfo = options.portalInfo || {};\n\n    const browerLocale =  navigator.language || (navigator as any).userLanguage;\n\n    // https://devtopia.esri.com/Beijing-R-D-Center/survey123-webform/issues/857\n    return this.convertToSupportedLang(options.userDefinedLocale)  ||\n      this.convertToSupportedLang(userInfo.culture) ||\n      this.convertToSupportedLang(portalInfo.culture) ||\n      this.convertToSupportedLang(browerLocale) || 'en';\n  }\n\n  /**\n  * convert the provided language code to the supported language code\n  * @param lang \n  */\n   static convertToSupportedLang(lang) {\n      const supportLangs: string[] = [\n        \"ar\",\n        \"bg\",\n        \"bs\",\n        \"ca\",\n        \"cs\",\n        \"da\",\n        \"de\",\n        \"el\",\n        \"en\",\n        \"es\",\n        \"et\",\n        \"fi\",\n        \"fr\",\n        \"he\",\n        \"hr\",\n        \"hu\",\n        \"id\",\n        \"it\",\n        \"ja\",\n        \"ko\",\n        \"lt\",\n        \"lv\",\n        \"nb\",\n        \"nl\",\n        \"pl\",\n        \"pt-br\",\n        \"pt-pt\",\n        \"ro\",\n        \"ru\",\n        \"sk\",\n        \"sl\",\n        \"sr\",\n        \"sv\",\n        \"th\",\n        \"tr\",\n        \"uk\",\n        \"vi\",\n        \"zh-cn\",\n        \"zh-hk\",\n        \"zh-tw\"\n      ];\n      const supportSubLocales = [\n        \"en-US\",\n        \"en-GB\",\n        \"en-AU\",\n        \"en-CA\",\n        \"es-ES\",\n        \"es-MX\",\n        \"it-CH\",\n        \"de-CH\",\n        \"de-AT\",\n        \"fr-CH\"\n      ];\n   lang = lang || '';\n   lang = (lang + '').toLowerCase();\n \n   const isSupportLangs = supportLangs.find((e) => {\n     return e.toLowerCase() === lang || e.toLowerCase() === lang.split('-')[0] || e.toLowerCase().split('-')[0] === lang;\n   });\n \n   const isSupportSubLocale = supportSubLocales.find((e) => {\n     return e.toLowerCase() === lang;\n   });\n   return isSupportSubLocale || isSupportLangs;\n }\n}"]}