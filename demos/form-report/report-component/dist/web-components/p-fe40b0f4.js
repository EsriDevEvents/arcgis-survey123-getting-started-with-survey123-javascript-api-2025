import{P as e}from"./p-33b03442.js";function t(e){return Object.keys(e).some((t=>{let r=e[t];if(!r){return false}if(r&&r.toParam){r=r.toParam()}const n=r.constructor.name;switch(n){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function r(e){const t={};Object.keys(e).forEach((r=>{var n,s;let i=e[r];if(i&&i.toParam){i=i.toParam()}if(!i&&i!==0&&typeof i!=="boolean"&&typeof i!=="string"){return}const o=i.constructor.name;let c;switch(o){case"Array":const e=(s=(n=i[0])===null||n===void 0?void 0:n.constructor)===null||s===void 0?void 0:s.name;c=e==="Array"?i:e==="Object"?JSON.stringify(i):i.join(",");break;case"Object":c=JSON.stringify(i);break;case"Date":c=i.valueOf();break;case"Function":c=null;break;case"Boolean":c=i+"";break;default:c=i;break}if(c||c===0||typeof c==="string"||Array.isArray(c)){t[r]=c}}));return t}function n(e,t){if(Array.isArray(t)&&t[0]&&Array.isArray(t[0])){return t.map((t=>n(e,t))).join("&")}return encodeURIComponent(e)+"="+encodeURIComponent(t)}function s(e){const t=r(e);return Object.keys(t).map((e=>n(e,t[e]))).join("&")}var i={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function o(e,n){const o=t(e)||n;const c=r(e);if(o){const e=new i.FormData;Object.keys(c).forEach((t=>{if(typeof Blob!=="undefined"&&c[t]instanceof Blob){const r=c["fileName"]||c[t].name||t;e.append(t,c[t],r)}else{e.append(t,c[t])}}));return e}else{return s(e)}}class c extends Error{constructor(e,t,r,n,s){super(e);const i=new.target.prototype;Object.setPrototypeOf(this,i);e=e||"UNKNOWN_ERROR";t=t||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=t==="UNKNOWN_ERROR_CODE"?e:`${t}: ${e}`;this.originalMessage=e;this.code=t;this.response=r;this.url=n;this.options=s}}function u(e){if(console&&console.warn){console.warn.apply(console,[e])}}var a=function e(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const l=`@esri/arcgis-rest-js`;function f(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class h extends c{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",r,n,s){super(e,t,r,n,s);this.name="ArcGISAuthError";this.message=t==="AUTHENTICATION_ERROR_CODE"?e:`${t}: ${e}`;const i=new.target.prototype;Object.setPrototypeOf(this,i)}retry(e,t=1){let r=0;const n=(s,i)=>{r=r+1;e(this.url,this.options).then((e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return m(this.url,t)})).then((e=>{s(e)})).catch((e=>{if(e.name==="ArcGISAuthError"&&r<t){n(s,i)}else if(e.name===this.name&&e.message===this.message&&r>=t){i(this)}else{i(e)}}))};return new Promise(((e,t)=>{n(e,t)}))}}function d(e,t,r,n,s){if(e.code>=400){const{message:r,code:s}=e;throw new c(r,s,e,t,n)}if(e.error){const{message:r,code:i,messageCode:o}=e.error;const u=o||i||"UNKNOWN_ERROR_CODE";if(i===498||i===499){if(s){throw s}else{throw new h(r,u,e,t,n)}}throw new c(r,u,e,t,n)}if(e.status==="failed"||e.status==="failure"){let r;let s="UNKNOWN_ERROR_CODE";try{r=JSON.parse(e.statusMessage).message;s=JSON.parse(e.statusMessage).code}catch(t){r=e.statusMessage||e.message}throw new c(r,s,e,t,n)}return e}function m(e,r){const n=f();const i=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},n),r),{params:Object.assign(Object.assign({},n.params),r.params),headers:Object.assign(Object.assign({},n.headers),r.headers)});const{httpMethod:h,rawResponse:m}=i;const p=Object.assign({f:"json"},i.params);let g=null;const O={method:h,signal:i.signal,credentials:i.credentials||"same-origin"};if(i.headers&&i.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1){O.credentials="include"}let b;if(typeof i.authentication==="string"){const e=i.authentication;b={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)};if(!i.authentication.startsWith("AAPK")&&!i.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){u(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{b=i.authentication}const w=e;return(b?b.getToken(e).catch((t=>{t.url=e;t.options=i;g=t;return Promise.resolve("")})):Promise.resolve("")).then((r=>{if(r.length){p.token=r}if(b&&b.getDomainCredentials){O.credentials=b.getDomainCredentials(e)}const n={};if(O.method==="GET"){if(p.token&&i.hideToken&&typeof window==="undefined"){n["X-Esri-Authorization"]=`Bearer ${p.token}`;delete p.token}const t=s(p);const o=t===""?e:e+"?"+s(p);if(i.maxUrlLength&&o.length>i.maxUrlLength||p.token&&i.hideToken){O.method="POST";if(r.length&&i.hideToken){p.token=r;delete n["X-Esri-Authorization"]}}else{e=o}}const c=new RegExp("/items/.+/updateResources").test(e);if(O.method==="POST"){O.body=o(p,c)}O.headers=Object.assign(Object.assign({},n),i.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!O.headers.referer){O.headers.referer=l}if(!t(p)&&!c){O.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(e,O):a().then((({fetch:t})=>t(e,O)))})).then((t=>{if(!t.ok){return t.json().then((r=>{const{status:n,statusText:s}=t;const{message:o,details:u}=r.error;const a=`${o}. ${u?u.join(" "):""}`.trim();throw new c(a,`HTTP ${n} ${s}`,r,e,i)})).catch((r=>{if(r.name==="ArcGISRequestError"){throw r}const{status:n,statusText:s}=t;throw new c(s,`HTTP ${n}`,t,e,i)}))}if(m){return t}switch(p.f){case"json":return t.json();case"geojson":return t.json();case"html":return t.text();case"text":return t.text();default:return t.blob()}})).then((t=>{if((p.f==="json"||p.f==="geojson")&&!m){const r=d(t,w,p,i,g);if(g){const t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];i.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+86400*1e3)};g=null}return r}else{return t}}))}function p(e,t={params:{f:"json"}}){return m(e,t).catch((e=>{if(e instanceof h&&t.authentication&&typeof t.authentication!=="string"&&t.authentication.canRefresh&&t.authentication.refreshCredentials){return e.retry((()=>t.authentication.refreshCredentials()),1)}else{return Promise.reject(e)}}))}function g(e){if(typeof e!=="string"){return e}e=e.trim();if(e[e.length-1]==="/"){e=e.slice(0,-1)}return e}function O(e={}){if(e.portal){return g(e.portal)}if(e.authentication&&typeof e.authentication!=="string"){return e.authentication.portal}return"https://www.arcgis.com/sharing/rest"}function b(e,t){const r=w(e,t);const n=Object.assign({httpMethod:"GET"},t);return p(r,n)}const w=(e,t)=>{const r=typeof t==="string"?t:O(t);return`${r}/content/items/${e}`};function T(e){const t=`${w(e.id,e)}/relatedItems`;const r=Object.assign({httpMethod:"GET",params:{direction:e.direction}},e);if(typeof e.relationshipType==="string"){r.params.relationshipType=e.relationshipType}else{r.params.relationshipTypes=e.relationshipType}delete r.direction;delete r.relationshipType;return p(t,r)}function R(e,t){const r=e?e:"self";const n=`${O(t)}/portals/${r}`;const s=Object.assign({httpMethod:"GET"},t);return p(n,s)}class j{constructor(){this.isPortal=false;this.svgCache={}}static getService(){if(!this.service){this.service=new j}return this.service}getPortalInfo(){if(this.portalInfo&&this.portalInfo.user){return Promise.resolve(this.portalInfo)}return R(null,this.getBaseRequestOptions()).then((e=>{if(!e.error){this.portalInfo=e;this.isPortal=e.isPortal;return e}else{throw new Error(JSON.stringify(e))}}))}getUser(){var e;return((e=this.portalInfo)===null||e===void 0?void 0:e.user)||{}}setDir(){document.getElementsByTagName("html")[0].dir=["ar","he"].indexOf(e.locale)!==-1?"rtl":"ltr"}getSurveyItemInfo(e){return b(e,this.getBaseRequestOptions()).then((e=>e))}getBaseRequestOptions(){return{authentication:e.token,portal:`${e.portalUrl}/sharing/rest`}}supportFeatureReport(){return!this.isPortal||this.isPortal&&this.compareVersion(this.portalInfo.currentVersion,this.getRestApiVersion("10.5.0"))>=0}formatFieldVal(e,t){var r,n;if(!t){return t}const s=e.type;const i=(r=e.domain)===null||r===void 0?void 0:r.codedValues;if(s==="esriFieldTypeDate"){t=this.formatDateTime(t)}else if(i){t=((n=i.find((e=>e.code===t)))===null||n===void 0?void 0:n.name)||t}else if(this.isNumberField(e)){t=this.formatNumber(t)}return t}isNumberField(e){if(!e){return false}const t=e.type;return"esriFieldTypeSingle,esriFieldTypeDouble,esriFieldTypeInteger,esriFieldTypeSmallInteger".split(",").includes(t)}formatNumber(t){return new Intl.NumberFormat(e.locale||"default").format(t)}formatDateTime(t,r){r=r||"date";if(!(t instanceof Date)){t=new Date(t)}const n={date:{year:"numeric",month:"numeric",day:"numeric"},time:{hour:"numeric",minute:"numeric",second:"numeric"},datetime:{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};if(!t){return""}return new Intl.DateTimeFormat(e.locale||"default",n[r]).format(t)}getPercentage(t,r,n){let s=0;if((!t||!t.jobStatusInfo)&&!r){return""}const i=r?r:Number(t.jobStatusInfo.progress+""||"0");let o=1;if(Math.round(i*100)===100&&i!==1){const e=(i+"").substr(3);let t=e.split("").findIndex((e=>parseInt(e,10)<9));if(t===-1){t=e.split("").length-1}o=t+1}s=Math.round(i*Math.pow(10,o+2))/Math.pow(10,o);if(n){return s}return new Intl.NumberFormat(e.locale,{style:"percent"}).format(s/100)}getFileSize(e){let t=0;let r="KB";if(e&&e>1024*1024){t=Number((e/(1024*1024)).toFixed(1));r="MB"}else{t=Number((e/1024).toFixed(1));r="KB"}return t+r}extractPlaceholders(e){e=e||"";const t=e.match(/\$[^{$]*?{[^}]*?.*?}/g),r=[];if(t){t.forEach((e=>{if(r.indexOf(e)===-1){r.push(e)}}))}return r}parseMarkdown(e){const t=(e+"").split("`");let r="";t.forEach(((e,t)=>{if(t%2===0){r+=e}else{r+="<i>"+e+"</i>"}}));return r}isUserCanPrintFeatureReport(){const e=this.getUser().privileges||[];const t=["premium:user:featurereport"];return e.filter((e=>t.indexOf(e)>-1)).length===t.length}setSvgCache(e,t){if(!e||!t){return}this.svgCache[e]=t}getSvgCache(e){if(!e){return this.svgCache}if(!this.svgCache){return null}return this.svgCache[e]}compareVersion(e,t){e=""+e;t=""+t;if(!e||!t){throw new Error("version is not existed")}let r,n;const s=/(\.0+)+$/;const i=e.replace(s,"").split(".");const o=t.replace(s,"").split(".");const c=Math.min(i.length,o.length);for(r=0;r<c;r++){n=parseInt(i[r],10)-parseInt(o[r],10);if(n){return n}}return i.length-o.length}getRestApiVersion(e){if(!e){return""}if(e==="10.9.1"){return"9.2"}if(e==="10.9.0"){return"8.4"}if(e==="10.8.1"){return"8.2"}if(e==="10.8.0"){return"7.3"}if(e==="10.7.2"){return"7.2"}if(e==="10.7.1"){return"7.1"}if(e==="10.7.0"){return"7.1"}if(e==="10.6.1"){return"6.1"}if(e==="10.6.0"){return"5.3"}if(e==="10.5.2"){return"5.2"}if(e==="10.5.1"){return"5.1"}if(e==="10.5.0"){return"4.4"}if(e==="10.4.0"){return"3.10"}return""}}export{c as A,l as N,j as U,h as a,T as b,g as c,O as d,s as e,b as g,p as r};
//# sourceMappingURL=p-fe40b0f4.js.map